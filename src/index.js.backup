#!/usr/bin/env node

import { Server } from '@modelcontextprotocol/sdk/server/index.js';
import { StdioServerTransport } from '@modelcontextprotocol/sdk/server/stdio.js';
import {
  CallToolRequestSchema,
  ErrorCode,
  ListToolsRequestSchema,
  ListResourcesRequestSchema,
  ReadResourceRequestSchema,
  McpError,
} from '@modelcontextprotocol/sdk/types.js';
import { MiriDevAuthTool } from './tools/auth.js';
import zlib from 'zlib';

class MiriDevMCPServer {
  constructor() {
    this.server = new Server(
      {
        name: 'miridev-mcp-server',
        version: '1.0.0',
      },
      {
        capabilities: {
          tools: {},
          resources: {},
        },
      }
    );

    this.authTool = new MiriDevAuthTool();
    
    // Artifact ë¦¬ì†ŒìŠ¤ ì €ì¥ì†Œ
    this.artifactStorage = new Map();
    
    // í˜„ì¬ ì„¸ì…˜ì˜ Artifact ë ˆì§€ìŠ¤íŠ¸ë¦¬ (ID â†’ Resource ë§¤í•‘)
    this.currentArtifacts = new Map();

    this.setupToolHandlers();
    this.setupResourceHandlers();
  }

  setupToolHandlers() {
    // ë„êµ¬ ëª©ë¡ ë°˜í™˜
    this.server.setRequestHandler(ListToolsRequestSchema, async () => {
      return {
        tools: [
          {
            name: 'check_auth_status',
            description: 'miri.dev ì¸ì¦ ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤.',
            inputSchema: {
              type: 'object',
              properties: {},
            },
          },
          {
            name: 'get_deployment_status',
            description: 'miri.dev ì„œë¹„ìŠ¤ ìƒíƒœì™€ ìµœê·¼ ë°°í¬ í˜„í™©ì„ í™•ì¸í•©ë‹ˆë‹¤.',
            inputSchema: {
              type: 'object',
              properties: {},
            },
          },
          {
            name: 'deploy_from_current_artifact',
            description: 'Artifact IDì™€ HTML ë‚´ìš©ìœ¼ë¡œ ìë™ ë“±ë¡ í›„ ì¦‰ì‹œ ë°°í¬í•©ë‹ˆë‹¤. ì›í´ë¦­ ë°°í¬ ë„êµ¬ì…ë‹ˆë‹¤.',
            inputSchema: {
              type: 'object',
              properties: {
                artifactId: {
                  type: 'string',
                  description: 'Claude Desktopì˜ í˜„ì¬ artifact ID (ì˜ˆ: artifact_1234567890)',
                },
                htmlContent: {
                  type: 'string',
                  description: 'í˜„ì¬ artifactì˜ ì™„ì „í•œ HTML ë‚´ìš© (<!DOCTYPE html>ë¶€í„° </html>ê¹Œì§€)',
                },
                projectName: {
                  type: 'string',
                  description: 'í”„ë¡œì íŠ¸ ì´ë¦„ (ì„ íƒì‚¬í•­, ê¸°ë³¸ê°’: "Claude Artifact")',
                },
                description: {
                  type: 'string',
                  description: 'í”„ë¡œì íŠ¸ ì„¤ëª… (ì„ íƒì‚¬í•­)',
                },
              },
              required: ['artifactId', 'htmlContent'],
            },
          },
          {
            name: 'deploy_single_file',
            description: 'ë‹¨ì¼ HTML íŒŒì¼ì„ miri.devì— ì¦‰ì‹œ ë°°í¬í•©ë‹ˆë‹¤. ê°„í¸í•œ ì›íŒŒì¼ ë°°í¬ ë„êµ¬ì…ë‹ˆë‹¤.',
            inputSchema: {
              type: 'object',
              properties: {
                filePath: {
                  type: 'string',
                  description: 'ë°°í¬í•  HTML íŒŒì¼ì˜ ì ˆëŒ€ ê²½ë¡œ ë˜ëŠ” ìƒëŒ€ ê²½ë¡œ (ì˜ˆ: ./index.html, /Users/user/page.html)',
                },
                projectName: {
                  type: 'string',
                  description: 'í”„ë¡œì íŠ¸ ì´ë¦„ (ì„ íƒì‚¬í•­, íŒŒì¼ëª…ìœ¼ë¡œ ìë™ ì„¤ì •)',
                },
                description: {
                  type: 'string',
                  description: 'í”„ë¡œì íŠ¸ ì„¤ëª… (ì„ íƒì‚¬í•­)',
                },
              },
              required: ['filePath'],
            },
          },
          {
            name: 'deploy_folder',
            description: 'ë¡œì»¬ í´ë”ì˜ ëª¨ë“  íŒŒì¼ì„ miri.devì— ë°°í¬í•©ë‹ˆë‹¤. CLIì™€ ë™ì¼í•œ ê¸°ëŠ¥ì…ë‹ˆë‹¤.',
            inputSchema: {
              type: 'object',
              properties: {
                folderPath: {
                  type: 'string',
                  description: 'ë°°í¬í•  í´ë”ì˜ ì ˆëŒ€ ê²½ë¡œ ë˜ëŠ” ìƒëŒ€ ê²½ë¡œ (ì˜ˆ: /Users/user/my-project, ./my-site)',
                },
                projectName: {
                  type: 'string',
                  description: 'í”„ë¡œì íŠ¸ ì´ë¦„ (ì„ íƒì‚¬í•­, í´ë”ëª…ìœ¼ë¡œ ìë™ ì„¤ì •)',
                },
                description: {
                  type: 'string',
                  description: 'í”„ë¡œì íŠ¸ ì„¤ëª… (ì„ íƒì‚¬í•­)',
                },
              },
              required: ['folderPath'],
            },
          },
        ],
      };
    });

    // ë„êµ¬ ì‹¤í–‰ ì²˜ë¦¬
    this.server.setRequestHandler(CallToolRequestSchema, async (request) => {
      const { name, arguments: args } = request.params;

      try {
        switch (name) {
          case 'check_auth_status':
            return await this.handleAuthStatus();

          case 'get_deployment_status':
            return await this.handleDeploymentStatus();

          case 'deploy_from_current_artifact':
            return await this.handleDeployFromCurrentArtifact(args);

          case 'deploy_folder':
            return await this.handleDeployFolder(args);

          default:
            throw new McpError(
              ErrorCode.MethodNotFound,
              `Unknown tool: ${name}`
            );
        }
      } catch (error) {
        console.error(`Tool execution error:`, error);
        throw new McpError(
          ErrorCode.InternalError,
          `Tool execution failed: ${error.message}`
        );
      }
    });
  }

  setupResourceHandlers() {
    // ë¦¬ì†ŒìŠ¤ ëª©ë¡ ë°˜í™˜
    this.server.setRequestHandler(ListResourcesRequestSchema, async () => {
      const resources = [];
      
      // ë°°í¬ ê°€ì´ë“œ ë¦¬ì†ŒìŠ¤ ì¶”ê°€
      resources.push({
        uri: 'guide://deployment-guide',
        name: 'ğŸš€ miri.dev Artifact ë°°í¬ ê°€ì´ë“œ',
        description: 'Claude Artifactë¥¼ miri.devì— ë°°í¬í•˜ëŠ” ë‹¨ê³„ë³„ ê°€ì´ë“œ',
        mimeType: 'text/markdown',
      });
      
      // í˜„ì¬ ì„¸ì…˜ì˜ ì§ì ‘ ì—°ê²°ëœ artifacts
      for (const [artifactId, artifactInfo] of this.currentArtifacts.entries()) {
        resources.push({
          uri: `artifact://${artifactId}`,
          name: `${artifactInfo.projectName} - Live Artifact`,
          description: artifactInfo.description || 'Current Session Artifact (í† í° ì†Œë¹„ ì—†ìŒ)',
          mimeType: 'text/html',
        });
      }

      return { resources };
    });

    // ë¦¬ì†ŒìŠ¤ ë‚´ìš© ì½ê¸°
    this.server.setRequestHandler(ReadResourceRequestSchema, async (request) => {
      const { uri } = request.params;
      
      if (uri === 'guide://deployment-guide') {
        // ë°°í¬ ê°€ì´ë“œ ë‚´ìš© ë°˜í™˜
        return {
          contents: [
            {
              uri,
              mimeType: 'text/markdown',
              text: this.getDeploymentGuide(),
            },
          ],
        };
      } else if (uri.startsWith('artifact://')) {
        // í˜„ì¬ ì„¸ì…˜ì˜ artifact (í† í° ì†Œë¹„ ì—†ì´ ì§ì ‘ ì ‘ê·¼)
        const artifactId = uri.replace('artifact://', '');
        const artifactInfo = this.currentArtifacts.get(artifactId);
        
        if (!artifactInfo) {
          throw new McpError(
            ErrorCode.InvalidRequest,
            `Current artifact not found: ${artifactId}`
          );
        }

        // ì‹¤ì œ HTML ë‚´ìš© ë°˜í™˜ (Claude Desktopì—ì„œ ì œê³µë˜ì–´ì•¼ í•¨)
        // í˜„ì¬ëŠ” ë©”íƒ€ë°ì´í„°ì™€ í•¨ê»˜ ì•ˆë‚´ ë©”ì‹œì§€ ë°˜í™˜
        return {
          contents: [
            {
              uri,
              mimeType: 'text/html',
              text: `<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${artifactInfo.projectName}</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background: #f9f9f9;
        }
        .info-box {
            background: #fff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        .artifact-id {
            color: #666;
            font-family: monospace;
            background: #f5f5f5;
            padding: 5px 10px;
            border-radius: 5px;
            display: inline-block;
            margin: 10px 0;
        }
        .status {
            color: #e74c3c;
            font-weight: bold;
        }
        .solution {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            text-align: left;
        }
    </style>
</head>
<body>
    <div class="info-box">
        <h1>ğŸ”— MCP Resource ì—°ê²°ë¨</h1>
        <p><strong>í”„ë¡œì íŠ¸:</strong> ${artifactInfo.projectName}</p>
        <div class="artifact-id">${artifactId}</div>
        <p class="status">âš ï¸ ì‹¤ì œ Artifact HTML ë‚´ìš©ì´ í•„ìš”í•©ë‹ˆë‹¤</p>
        
        <div class="solution">
            <h3>ğŸ’¡ í•´ê²° ë°©ë²•:</h3>
            <p>Claude Desktopì—ì„œ í˜„ì¬ artifactì˜ ì‹¤ì œ HTML ë‚´ìš©ì„ ì´ Resourceë¡œ ì œê³µí•´ì•¼ í•©ë‹ˆë‹¤.</p>
            <p><strong>í˜„ì¬ ìƒíƒœ:</strong> ë©”íƒ€ë°ì´í„°ë§Œ ì‚¬ìš© ê°€ëŠ¥</p>
            <p><strong>í•„ìš”:</strong> ì‹¤ì œ artifact HTML â†’ Resource ì—°ë™</p>
        </div>
        
        <p><small>ë“±ë¡ ì‹œê°„: ${new Date(artifactInfo.registeredAt).toLocaleString()}</small></p>
    </div>
</body>
</html>`,
            },
          ],
        };
      } else {
        throw new McpError(
          ErrorCode.InvalidRequest,
          `Unsupported resource URI: ${uri}`
        );
      }
    });
  }

  async handleDeployFromCurrentArtifact(args) {
    const { artifactId, htmlContent, projectName, description } = args;

    try {
      process.stderr.write(`ğŸš€ [DEPLOY] í†µí•© ë°°í¬ ì‹œì‘: ${artifactId}\n`);
      process.stderr.write(`ğŸ” [DEBUG] í”„ë¡œì íŠ¸ëª…: ${projectName || 'Claude Artifact'}\n`);
      process.stderr.write(`ğŸ” [DEBUG] ì„¤ëª…: ${description || 'ì—†ìŒ'}\n`);
      
      // 1ë‹¨ê³„: Artifact ìë™ ë“±ë¡
      const finalProjectName = projectName || 'Claude Artifact';
      this.currentArtifacts.set(artifactId, {
        projectName: finalProjectName,
        description,
        registeredAt: new Date().toISOString(),
      });
      
      // 2ë‹¨ê³„: HTML ë‚´ìš© ê²€ì¦
      process.stderr.write(`ğŸ” [DEBUG] HTML ë‚´ìš© ê²€ì¦ ì¤‘...\n`);
      
      if (!htmlContent || htmlContent.trim().length === 0) {
        return {
          content: [
            {
              type: 'text',
              text: `âŒ HTML ë‚´ìš©ì´ ì œê³µë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\n\nğŸ†” Artifact ID: ${artifactId}\nğŸ“ í”„ë¡œì íŠ¸ëª…: ${finalProjectName}\n\n**ì‚¬ìš©ë²•:**\ní˜„ì¬ ${artifactId} artifactì˜ HTML ì½”ë“œë¥¼ ë³µì‚¬í•´ì„œ ë‹¤ìŒê³¼ ê°™ì´ í˜¸ì¶œí•´ì£¼ì„¸ìš”:\n\n\`\`\`\ndeploy_from_current_artifact({\n  artifactId: "${artifactId}",\n  htmlContent: "<!DOCTYPE html>..." // ì—¬ê¸°ì— ë³µì‚¬í•œ HTML ë¶™ì—¬ë„£ê¸°\n  projectName: "${finalProjectName}"\n})\n\`\`\`\n\nğŸ’¡ **íŒ:** artifact í™”ë©´ì—ì„œ ì „ì²´ HTML ì½”ë“œë¥¼ ë³µì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`,
            },
          ],
        };
      }
      
      process.stderr.write(`ğŸ“„ [DEBUG] HTML í¬ê¸°: ${htmlContent.length} bytes\n`);
      const finalHtmlContent = htmlContent;
      
      // 3ë‹¨ê³„: HTML ë‚´ìš©ìœ¼ë¡œ ë°°í¬
      const deployResult = await this.deployToMiriDev({
        htmlContent: finalHtmlContent,
        projectName: finalProjectName,
        description,
      });

      // deployResult ë¡œê·¸
      process.stderr.write(`ğŸ” [DEBUG] ë°°í¬ ê²°ê³¼: ${JSON.stringify(deployResult)}\n`);

      // ë°°í¬ ê²°ê³¼ ë°˜í™˜
      if (deployResult.success) {
        return {
          content: [
            {
              type: 'text',
              text: `ğŸ‰ Artifact í†µí•© ë°°í¬ ì„±ê³µ!\n\nğŸ†” Artifact ID: ${artifactId}\nğŸ“ í”„ë¡œì íŠ¸ëª…: ${finalProjectName}\nğŸ“ ì‚¬ì´íŠ¸ URL: ${deployResult.site.url}\nğŸ†” ì‚¬ì´íŠ¸ ID: ${deployResult.site.shortId}\nâ° ë°°í¬ ì‹œê°„: ${new Date(deployResult.site.created_at).toLocaleString()}\nğŸ“Š íŒŒì¼ ìˆ˜: ${deployResult.site.fileCount}ê°œ\nâ³ ë§Œë£Œì¼: ${new Date(deployResult.site.expires_at).toLocaleString()}\n\n${description ? `ğŸ“ ì„¤ëª…: ${description}\n\n` : ''}âœ… **ì „ì²´ ê³¼ì • ì™„ë£Œ:** ë“±ë¡ â†’ ë°°í¬ â†’ ì™„ë£Œ!\n\nğŸ¯ **ë°”ë¡œ ì ‘ì†í•´ì„œ í™•ì¸í•´ë³´ì„¸ìš”:** ${deployResult.site.url}\n\nğŸ’¡ **íšŒì›ê°€ì… í˜œíƒ:**\nâ€¢ í˜„ì¬: 1ì‹œê°„ ë¬´ë£Œ í˜¸ìŠ¤íŒ…\nâ€¢ íšŒì›ê°€ì… ì‹œ: 3ì¼ ë¬´ë£Œ í˜¸ìŠ¤íŒ… (72ì‹œê°„)\nâ€¢ ì¶”ê°€ í˜œíƒ: ë°°í¬ íˆìŠ¤í† ë¦¬, ì»¤ìŠ¤í…€ ë„ë©”ì¸\n\nğŸ‘‰ **íšŒì›ê°€ì…:** https://www.miri.dev/dashboard`,
            },
          ],
        };
      } else {
        return {
          content: [
            {
              type: 'text',
              text: `âŒ Artifact í†µí•© ë°°í¬ ì‹¤íŒ¨\n\nğŸ†” Artifact ID: ${artifactId}\nğŸ“ í”„ë¡œì íŠ¸ëª…: ${finalProjectName}\n\nì˜¤ë¥˜ ë‚´ìš©: ${deployResult.error}\n\nâœ… **ë“±ë¡ ì™„ë£Œ:** ArtifactëŠ” Resourceë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤\nâŒ **ë°°í¬ ì‹¤íŒ¨:** ë„¤íŠ¸ì›Œí¬ ë˜ëŠ” ì„œë²„ ì˜¤ë¥˜\n\nğŸ”„ **ì¬ì‹œë„:** ë™ì¼í•œ ë„êµ¬ë¡œ ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”`,
            },
          ],
        };
      }

    } catch (error) {
      process.stderr.write(`âŒ [ERROR] í†µí•© ë°°í¬ ì‹¤íŒ¨: ${error.message}\n`);
      process.stderr.write(`âŒ [ERROR] ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤: ${error.stack}\n`);
      return {
        content: [
          {
            type: 'text',
            text: `âŒ Artifact í†µí•© ë°°í¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤\n\n${error.message}\n\nğŸ” **ë””ë²„ê·¸:** ìì„¸í•œ ì˜¤ë¥˜ ë¡œê·¸ëŠ” stderrì—ì„œ í™•ì¸í•˜ì„¸ìš”.\n\nğŸ’¡ **ë„ì›€ë§:**\n- HTML ë‚´ìš©ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”\n- ë„¤íŠ¸ì›Œí¬ ì—°ê²° ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”\n- ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”`,
          },
        ],
      };
    }
  }



  async handleDeployFolder(args) {
    const { folderPath, projectName, description } = args;

    try {
      process.stderr.write(`ğŸ“ [DEPLOY] í´ë” ë°°í¬ ì‹œì‘: ${folderPath}\n`);
      
      // 1ë‹¨ê³„: í´ë” ê²½ë¡œ ê²€ì¦
      const fs = await import('fs');
      const path = await import('path');
      
      let resolvedPath;
      if (path.isAbsolute(folderPath)) {
        resolvedPath = folderPath;
      } else {
        resolvedPath = path.resolve(process.cwd(), folderPath);
      }
      
      process.stderr.write(`ğŸ” [DEBUG] í•´ê²°ëœ ê²½ë¡œ: ${resolvedPath}\n`);
      
      if (!fs.existsSync(resolvedPath)) {
        return {
          content: [
            {
              type: 'text',
              text: `âŒ í´ë”ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${folderPath}\n\ní•´ê²°ëœ ê²½ë¡œ: ${resolvedPath}\n\n**í™•ì¸ì‚¬í•­:**\n- ê²½ë¡œê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•˜ì„¸ìš”\n- ì ˆëŒ€ ê²½ë¡œ ë˜ëŠ” ìƒëŒ€ ê²½ë¡œ ëª¨ë‘ ê°€ëŠ¥í•©ë‹ˆë‹¤\n- ì˜ˆì‹œ: ./my-site, /Users/user/project`,
            },
          ],
        };
      }
      
      if (!fs.statSync(resolvedPath).isDirectory()) {
        return {
          content: [
            {
              type: 'text',
              text: `âŒ ì§€ì •ëœ ê²½ë¡œê°€ í´ë”ê°€ ì•„ë‹™ë‹ˆë‹¤: ${folderPath}\n\ní•´ê²°ëœ ê²½ë¡œ: ${resolvedPath}\n\ní´ë” ê²½ë¡œë¥¼ ì§€ì •í•´ì£¼ì„¸ìš”.`,
            },
          ],
        };
      }
      
      // 2ë‹¨ê³„: í”„ë¡œì íŠ¸ëª… ì„¤ì •
      const finalProjectName = projectName || path.basename(resolvedPath);
      process.stderr.write(`ğŸ“ [DEBUG] í”„ë¡œì íŠ¸ëª…: ${finalProjectName}\n`);
      
      // 3ë‹¨ê³„: íŒŒì¼ ìˆ˜ì§‘ (CLIì™€ ë™ì¼í•œ ë¡œì§)
      process.stderr.write(`ğŸ” [DEBUG] íŒŒì¼ ìŠ¤ìº” ì‹œì‘...\n`);
      const files = await this.collectFiles(resolvedPath);
      
      if (files.length === 0) {
        return {
          content: [
            {
              type: 'text',
              text: `âŒ ë°°í¬í•  íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤: ${folderPath}\n\ní•´ê²°ëœ ê²½ë¡œ: ${resolvedPath}\n\n**í™•ì¸ì‚¬í•­:**\n- í´ë”ì— HTML, CSS, JS ë“±ì˜ íŒŒì¼ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”\n- ìˆ¨ê¹€ íŒŒì¼ì€ ì œì™¸ë©ë‹ˆë‹¤`,
            },
          ],
        };
      }
      
      process.stderr.write(`ğŸ“Š [DEBUG] ìˆ˜ì§‘ëœ íŒŒì¼: ${files.length}ê°œ\n`);
      files.forEach(file => {
        process.stderr.write(`  - ${file.relativePath} (${file.size} bytes)\n`);
      });
      
      // 4ë‹¨ê³„: CLI APIë¡œ ë°°í¬
      const deployResult = await this.deployFolderToMiriDev({
        files,
        projectName: finalProjectName,
        description,
        folderPath: resolvedPath,
      });
      
      if (deployResult.success) {
        return {
          content: [
            {
              type: 'text',
              text: `ğŸ‰ í´ë” ë°°í¬ ì„±ê³µ!\n\nğŸ“ í´ë”: ${folderPath}\nğŸ“ í”„ë¡œì íŠ¸ëª…: ${finalProjectName}\nğŸ“ ì‚¬ì´íŠ¸ URL: ${deployResult.site.url}\nğŸ†” ì‚¬ì´íŠ¸ ID: ${deployResult.site.shortId}\nâ° ë°°í¬ ì‹œê°„: ${new Date(deployResult.site.created_at).toLocaleString()}\nğŸ“Š íŒŒì¼ ìˆ˜: ${deployResult.site.fileCount}ê°œ\nâ³ ë§Œë£Œì¼: ${new Date(deployResult.site.expires_at).toLocaleString()}\n\n${description ? `ğŸ“ ì„¤ëª…: ${description}\n\n` : ''}ğŸ¯ **ë°”ë¡œ ì ‘ì†í•´ì„œ í™•ì¸í•´ë³´ì„¸ìš”:** ${deployResult.site.url}\n\nğŸ’¡ **íšŒì›ê°€ì… í˜œíƒ:**\nâ€¢ í˜„ì¬: 1ì‹œê°„ ë¬´ë£Œ í˜¸ìŠ¤íŒ…\nâ€¢ íšŒì›ê°€ì… ì‹œ: 3ì¼ ë¬´ë£Œ í˜¸ìŠ¤íŒ… (72ì‹œê°„)\nâ€¢ ì¶”ê°€ í˜œíƒ: ë°°í¬ íˆìŠ¤í† ë¦¬, ì»¤ìŠ¤í…€ ë„ë©”ì¸\n\nğŸ‘‰ **íšŒì›ê°€ì…:** https://www.miri.dev/dashboard`,
            },
          ],
        };
      } else {
        return {
          content: [
            {
              type: 'text',
              text: `âŒ í´ë” ë°°í¬ ì‹¤íŒ¨\n\nğŸ“ í´ë”: ${folderPath}\nğŸ“ í”„ë¡œì íŠ¸ëª…: ${finalProjectName}\n\nì˜¤ë¥˜ ë‚´ìš©: ${deployResult.error}\n\nğŸ”„ **ì¬ì‹œë„:** ê°™ì€ ëª…ë ¹ìœ¼ë¡œ ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”`,
            },
          ],
        };
      }
      
    } catch (error) {
      process.stderr.write(`âŒ [ERROR] í´ë” ë°°í¬ ì‹¤íŒ¨: ${error.message}\n`);
      process.stderr.write(`âŒ [ERROR] ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤: ${error.stack}\n`);
      return {
        content: [
          {
            type: 'text',
            text: `âŒ í´ë” ë°°í¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤\n\n${error.message}\n\nğŸ” **ë””ë²„ê·¸:** ìì„¸í•œ ì˜¤ë¥˜ ë¡œê·¸ëŠ” stderrì—ì„œ í™•ì¸í•˜ì„¸ìš”.\n\nğŸ’¡ **ë„ì›€ë§:**\n- í´ë” ê²½ë¡œê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”\n- ì½ê¸° ê¶Œí•œì´ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”\n- ë„¤íŠ¸ì›Œí¬ ì—°ê²° ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”`,
          },
        ],
      };
    }
  }

  async collectFiles(folderPath) {
    const fs = await import('fs');
    const path = await import('path');
    const files = [];
    
    function scanDirectory(dir, baseDir = dir) {
      const items = fs.readdirSync(dir);
      
      for (const item of items) {
        const fullPath = path.join(dir, item);
        const stat = fs.statSync(fullPath);
        
        if (stat.isDirectory()) {
          // ìˆ¨ê¹€ í´ë”ì™€ node_modules ì œì™¸
          if (!item.startsWith('.') && item !== 'node_modules') {
            scanDirectory(fullPath, baseDir);
          }
        } else if (stat.isFile()) {
          // ìˆ¨ê¹€ íŒŒì¼ ì œì™¸
          if (!item.startsWith('.')) {
            const relativePath = path.relative(baseDir, fullPath);
            const content = fs.readFileSync(fullPath);
            
            files.push({
              relativePath: relativePath.replace(/\\/g, '/'), // Windows ê²½ë¡œ ì •ê·œí™”
              content,
              size: stat.size,
              fullPath,
            });
          }
        }
      }
    }
    
    scanDirectory(folderPath);
    return files;
  }

  async deployFolderToMiriDev(args) {
    const { files, projectName, description, folderPath } = args;

    try {
      process.stderr.write(`ğŸš€ [DEPLOY] "${projectName}" í´ë” ë°°í¬ ì‹œì‘...\n`);
      process.stderr.write(`ğŸ“ [DEBUG] í´ë”: ${folderPath}\n`);
      process.stderr.write(`ğŸ“Š [DEBUG] íŒŒì¼ ìˆ˜: ${files.length}ê°œ\n`);
      
      // FormData ìƒì„± (CLIì™€ ë™ì¼í•œ ë°©ì‹)
      const FormData = (await import('form-data')).default;
      const form = new FormData();
      
      // ë©”íƒ€ë°ì´í„° ì¶”ê°€
      form.append('projectName', projectName || 'folder-site');
      form.append('title', projectName || 'Folder Site');
      form.append('description', description || `${projectName} í´ë”ì—ì„œ ë°°í¬ëœ ì‚¬ì´íŠ¸`);
      form.append('userEmail', 'mcp-user@miri.dev');
      form.append('userId', 'mcp-folder-user');
      
      // íŒŒì¼ë“¤ ì¶”ê°€
      files.forEach((file, index) => {
        form.append(`file_${index}`, file.content, {
          filename: file.relativePath.split('/').pop(), // íŒŒì¼ëª…ë§Œ
          contentType: this.getContentType(file.relativePath),
        });
        form.append(`filePath_${index}`, file.relativePath); // ì „ì²´ ê²½ë¡œ
      });
      
      process.stderr.write(`ğŸŒ [DEBUG] API í˜¸ì¶œ ì‹œì‘: https://www.miri.dev/api/deploy\n`);

      const response = await fetch('https://www.miri.dev/api/deploy', {
        method: 'POST',
        headers: {
          'User-Agent': 'miri-dev-mcp-client/1.0.0',
          ...form.getHeaders(),
        },
        body: form,
        timeout: 60000, // 60ì´ˆ íƒ€ì„ì•„ì›ƒ (íŒŒì¼ì´ ë§ì„ ìˆ˜ ìˆìŒ)
      });

      process.stderr.write(`ğŸ“¡ [DEBUG] API ì‘ë‹µ: ${response.status} ${response.statusText}\n`);

      if (!response.ok) {
        const errorText = await response.text();
        process.stderr.write(`âŒ [ERROR] ì‘ë‹µ ë‚´ìš©: ${errorText}\n`);
        
        let errorMessage = `HTTP ${response.status}: ${response.statusText}`;
        
        try {
          const errorData = JSON.parse(errorText);
          errorMessage = errorData.error || errorMessage;
          process.stderr.write(`âŒ [ERROR] íŒŒì‹±ëœ ì˜¤ë¥˜: ${errorMessage}\n`);
        } catch (e) {
          errorMessage += `\nResponse: ${errorText}`;
        }
        
        return { success: false, error: errorMessage };
      }

      const result = await response.json();
      process.stderr.write(`âœ… [SUCCESS] í´ë” ë°°í¬ ì™„ë£Œ! ì‚¬ì´íŠ¸ ID: ${result.site?.shortId || 'N/A'}\n`);
      return result;

    } catch (error) {
      process.stderr.write(`âŒ [ERROR] í´ë” ë°°í¬ ì¤‘ ì˜ˆì™¸ ë°œìƒ: ${error.message}\n`);
      process.stderr.write(`âŒ [ERROR] ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤: ${error.stack}\n`);
      
      return { success: false, error: error.message };
    }
  }

  getContentType(filePath) {
    const ext = filePath.split('.').pop()?.toLowerCase();
    const contentTypes = {
      'html': 'text/html',
      'css': 'text/css',
      'js': 'application/javascript',
      'json': 'application/json',
      'png': 'image/png',
      'jpg': 'image/jpeg',
      'jpeg': 'image/jpeg',
      'gif': 'image/gif',
      'svg': 'image/svg+xml',
      'ico': 'image/x-icon',
      'txt': 'text/plain',
      'md': 'text/markdown',
    };
    return contentTypes[ext] || 'application/octet-stream';
  }

  async deployToMiriDev(args) {
    const { htmlContent, projectName, description } = args;

    try {
      process.stderr.write(`ğŸš€ [DEPLOY] "${projectName}" ë°°í¬ ì‹œì‘...\n`);
      process.stderr.write(`ğŸ” [DEBUG] HTML í¬ê¸°: ${htmlContent.length} bytes\n`);
      
      // gzip ì••ì¶• ì ìš©
      process.stderr.write(`ğŸ” [DEBUG] gzip ì••ì¶• ì‹œì‘...\n`);
      const compressedHtml = zlib.gzipSync(Buffer.from(htmlContent, 'utf8'));
      
      const deployData = {
        htmlContent: compressedHtml.toString('base64'),
        projectName: projectName || 'artifact-site',
        title: projectName || 'Artifact Site',
        description: description || 'Claude Artifactì—ì„œ ìƒì„±ëœ ì‚¬ì´íŠ¸',
        userEmail: 'mcp-user@miri.dev',
        userId: 'mcp-artifact-user',
        compressed: true
      };

      process.stderr.write(`ğŸ“¦ [DEBUG] ì••ì¶• ì™„ë£Œ: ì›ë³¸ ${htmlContent.length}B -> ì••ì¶• ${compressedHtml.length}B (${((1 - compressedHtml.length / htmlContent.length) * 100).toFixed(1)}% ì ˆì•½)\n`);
      process.stderr.write(`ğŸŒ [DEBUG] API í˜¸ì¶œ ì‹œì‘: https://www.miri.dev/api/deploy-html\n`);

      const response = await fetch('https://www.miri.dev/api/deploy-html', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'User-Agent': 'miri-dev-mcp-client/1.0.0',
        },
        body: JSON.stringify(deployData),
        timeout: 30000, // 30ì´ˆ íƒ€ì„ì•„ì›ƒ
      });

      process.stderr.write(`ğŸ“¡ [DEBUG] API ì‘ë‹µ: ${response.status} ${response.statusText}\n`);



      if (!response.ok) {
        const errorText = await response.text();
        process.stderr.write(`âŒ [ERROR] ì‘ë‹µ ë‚´ìš©: ${errorText}\n`);
        
        let errorMessage = `HTTP ${response.status}: ${response.statusText}`;
        
        try {
          const errorData = JSON.parse(errorText);
          errorMessage = errorData.error || errorMessage;
          process.stderr.write(`âŒ [ERROR] íŒŒì‹±ëœ ì˜¤ë¥˜: ${errorMessage}\n`);
        } catch (e) {
          errorMessage += `\nResponse: ${errorText}`;
          process.stderr.write(`âŒ [ERROR] JSON íŒŒì‹± ì‹¤íŒ¨: ${e.message}\n`);
        }
        
        return { success: false, error: errorMessage };
      }

      const result = await response.json();
      process.stderr.write(`âœ… [SUCCESS] ë°°í¬ ì™„ë£Œ! ì‚¬ì´íŠ¸ ID: ${result.site?.shortId || 'N/A'}\n`);
      return result;

    } catch (error) {
      process.stderr.write(`âŒ [ERROR] ë°°í¬ ì¤‘ ì˜ˆì™¸ ë°œìƒ: ${error.message}\n`);
      process.stderr.write(`âŒ [ERROR] ì˜¤ë¥˜ íƒ€ì…: ${error.name}\n`);
      process.stderr.write(`âŒ [ERROR] ì˜¤ë¥˜ ì½”ë“œ: ${error.code || 'N/A'}\n`);
      
      // ë„¤íŠ¸ì›Œí¬ ê´€ë ¨ ì˜¤ë¥˜ ìƒì„¸ ì •ë³´
      if (error.cause) {
        process.stderr.write(`âŒ [ERROR] ì›ì¸: ${error.cause.message}\n`);
        process.stderr.write(`âŒ [ERROR] ì›ì¸ ì½”ë“œ: ${error.cause.code || 'N/A'}\n`);
      }
      
      process.stderr.write(`âŒ [ERROR] ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤: ${error.stack}\n`);
      
      // ì‚¬ìš©ì ì¹œí™”ì  ì˜¤ë¥˜ ë©”ì‹œì§€
      let userMessage = error.message;
      if (error.message === 'fetch failed') {
        userMessage = 'ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì‹¤íŒ¨ - miri.dev ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
        
        // ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œë„
        process.stderr.write(`ğŸ” [DEBUG] ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œë„...\n`);
        try {
          const testResponse = await fetch('https://www.miri.dev', { 
            method: 'HEAD',
            timeout: 5000
          });
          process.stderr.write(`ğŸ” [DEBUG] ê¸°ë³¸ ì—°ê²° í…ŒìŠ¤íŠ¸: ${testResponse.status}\n`);
        } catch (testError) {
          process.stderr.write(`âŒ [ERROR] ê¸°ë³¸ ì—°ê²°ë„ ì‹¤íŒ¨: ${testError.message}\n`);
        }
      }
      
      return { success: false, error: userMessage };
    }
  }

  async handleAuthStatus() {
    const status = await this.authTool.getDetailedStatus();
    
    return {
      content: [
        {
          type: 'text',
          text: `ğŸ” miri.dev ì¸ì¦ ìƒíƒœ\n\n${status.isAuthenticated ? 'âœ… ë¡œê·¸ì¸ë¨' : 'âŒ ë¡œê·¸ì¸ í•„ìš”'}\n\n${status.details}`,
        },
      ],
    };
  }

  async handleDeploymentStatus() {
    try {
      process.stderr.write(`ğŸ” [DEBUG] miri.dev ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸ ì‹œì‘...\n`);
      
      // miri.dev ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
      const response = await fetch('https://www.miri.dev', {
        method: 'HEAD',
        headers: {
          'User-Agent': 'miri-dev-mcp-client/1.0.0',
        },
        timeout: 10000
      });

      process.stderr.write(`ğŸ” [DEBUG] API ì‘ë‹µ ìƒíƒœ: ${response.status} ${response.statusText}\n`);
      
      // ë¦¬ë‹¤ì´ë ‰íŠ¸ë„ ì •ìƒìœ¼ë¡œ ê°„ì£¼
      const serviceStatus = (response.ok || (response.status >= 300 && response.status < 400)) ? 'ğŸŸ¢ ì •ìƒ' : 'ğŸ”´ ì¥ì• ';
      
      // ì¸ì¦ ìƒíƒœ í™•ì¸
      process.stderr.write(`ğŸ” [DEBUG] ì¸ì¦ ìƒíƒœ í™•ì¸ ì¤‘...\n`);
      const authStatus = await this.authTool.checkAuthStatus();
      const authText = authStatus ? 'ğŸ” ë¡œê·¸ì¸ë¨' : 'ğŸ”“ ë¡œê·¸ì¸ í•„ìš”';

      // ìµœê·¼ ë°°í¬ ì •ë³´ (ë¡œì»¬ ìƒíƒœ)
      const recentDeployments = this.getRecentDeployments();

      process.stderr.write(`âœ… [DEBUG] ìƒíƒœ í™•ì¸ ì™„ë£Œ - ì„œë¹„ìŠ¤: ${serviceStatus}, ì¸ì¦: ${authText}\n`);

      return {
        content: [
          {
            type: 'text',
            text: `ğŸ“Š miri.dev ë°°í¬ ìƒíƒœ\n\nğŸŒ ì„œë¹„ìŠ¤ ìƒíƒœ: ${serviceStatus}\n${authText}\n\nğŸ“ˆ ìµœê·¼ ë°°í¬ í˜„í™©:\n${recentDeployments}\n\nğŸ’¡ ì‚¬ìš© ê°€ëŠ¥í•œ ê¸°ëŠ¥:\nâ€¢ deploy_from_current_artifact: Artifact HTML ë°°í¬ (ì›í´ë¦­)\nâ€¢ deploy_folder: ë¡œì»¬ í´ë” ë°°í¬ (CLIì™€ ë™ì¼)\nâ€¢ check_auth_status: ì¸ì¦ ìƒíƒœ í™•ì¸\n\nğŸ¯ **ë‘ ê°€ì§€ ë°°í¬ ë°©ì‹:**\n1. **Artifact ë°°í¬**: Claudeì—ì„œ ìƒì„±í•œ HTMLì„ ì¦‰ì‹œ ë°°í¬\n2. **í´ë” ë°°í¬**: ë¡œì»¬ í”„ë¡œì íŠ¸ í´ë”ë¥¼ í†µì§¸ë¡œ ë°°í¬\n\nğŸ“– **ë°°í¬ ê°€ì´ë“œ:** Resource íŒ¨ë„ì—ì„œ "ğŸš€ miri.dev Artifact ë°°í¬ ê°€ì´ë“œ"ë¥¼ í™•ì¸í•˜ì„¸ìš”!\nâ° **ë°°í¬ í˜œíƒ:** ë¡œê·¸ì¸ ì—†ì´ 1ì‹œê°„ ë¬´ë£Œ â†’ íšŒì›ê°€ì… ì‹œ 3ì¼ ë¬´ë£Œ\n\nğŸš€ ì¤€ë¹„ ì™„ë£Œ! ì›í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë°°í¬í•´ë³´ì„¸ìš”.\n\nğŸ” **ë””ë²„ê·¸ ì •ë³´:** ìì„¸í•œ ë¡œê·¸ëŠ” stderrì—ì„œ í™•ì¸í•˜ì„¸ìš”.`,
          },
        ],
      };

    } catch (error) {
      process.stderr.write(`âŒ [ERROR] ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨: ${error.message}\n`);
      process.stderr.write(`âŒ [ERROR] ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤: ${error.stack}\n`);
      
      return {
        content: [
          {
            type: 'text',
            text: `ğŸ“Š miri.dev ë°°í¬ ìƒíƒœ\n\nâŒ ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨: ${error.message}\n\nğŸ” **ë””ë²„ê·¸ ì •ë³´:**\n- ì˜¤ë¥˜ íƒ€ì…: ${error.name}\n- ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™•ì¸ í•„ìš”\n- fetch timeout: 5ì´ˆ\n\nğŸ’¡ ê·¸ë˜ë„ ë“±ë¡/ë°°í¬ëŠ” ì‹œë„í•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:\nâ€¢ register_current_artifactë¡œ artifactë¥¼ ë“±ë¡í•´ë³´ì„¸ìš”\nâ€¢ deploy_with_htmlë¡œ ì§ì ‘ ë°°í¬í•´ë³´ì„¸ìš”\nâ€¢ ìì„¸í•œ ì˜¤ë¥˜ ë¡œê·¸ëŠ” stderrì—ì„œ í™•ì¸í•˜ì„¸ìš”`,
          },
        ],
      };
    }
  }

  getRecentDeployments() {
    // ê°„ë‹¨í•œ ë¡œì»¬ ë°°í¬ ê¸°ë¡ (ì‹¤ì œë¡œëŠ” ì„œë²„ì—ì„œ ê°€ì ¸ì™€ì•¼ í•¨)
    return 'â€¢ ìµœê·¼ ë°°í¬ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤\nâ€¢ register_current_artifactë¥¼ ì‚¬ìš©í•´ì„œ ì²« ë“±ë¡ì„ ì‹œì‘í•´ë³´ì„¸ìš”!';
  }

  getDeploymentGuide() {
    return `# ğŸš€ miri.dev Artifact ë°°í¬ ê°€ì´ë“œ

Claude Desktopì—ì„œ ìƒì„±í•œ Artifactë¥¼ miri.devì— ë°°í¬í•˜ëŠ” ì™„ì „í•œ ê°€ì´ë“œì…ë‹ˆë‹¤.

## ğŸ“‹ ì›í´ë¦­ ë°°í¬ ì ˆì°¨

### ğŸ¯ ìƒˆë¡œìš´ í†µí•© ë°°í¬ ë„êµ¬ (ê¶Œì¥)
\`\`\`
deploy_from_current_artifact({
  artifactId: "artifact_1234567890",
  projectName: "ë‚´ í”„ë¡œì íŠ¸",  // ì„ íƒì‚¬í•­
  description: "í”„ë¡œì íŠ¸ ì„¤ëª…"  // ì„ íƒì‚¬í•­
})
\`\`\`

**íŠ¹ì§•:**
- âœ… **ìë™ ë“±ë¡**: Artifactë¥¼ ìë™ìœ¼ë¡œ Resourceì— ë“±ë¡
- âœ… **ì¦‰ì‹œ ë°°í¬**: HTML ë‚´ìš©ë§Œ ì œê³µí•˜ë©´ ë°”ë¡œ ë°°í¬
- âœ… **í† í° ì ˆì•½**: Resource ê¸°ë°˜ìœ¼ë¡œ í† í° ì†Œë¹„ ìµœì†Œí™”
- âœ… **ì›í´ë¦­**: í•˜ë‚˜ì˜ ë„êµ¬ë¡œ ì „ì²´ ê³¼ì • ì™„ë£Œ

**ì£¼ì˜ì‚¬í•­:**
- artifactIdëŠ” Claudeê°€ ìƒì„±í•œ ì •í™•í•œ IDë¥¼ ì‚¬ìš©í•˜ì„¸ìš”
- projectNameì€ ë°°í¬ë  ì‚¬ì´íŠ¸ì˜ ì´ë¦„ì´ ë©ë‹ˆë‹¤ (ê¸°ë³¸ê°’: "Claude Artifact")

## â° ë°°í¬ ì‹œê°„ ì œí•œ

### ğŸ†“ ë¬´ë£Œ ì‚¬ìš©ì (ë¡œê·¸ì¸ ì—†ìŒ)
- **1ì‹œê°„ ë¬´ë£Œ** í˜¸ìŠ¤íŒ…
- ë°°í¬ ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥
- 1ì‹œê°„ í›„ ìë™ ì‚­ì œ

### ğŸ¯ íšŒì› ê°€ì… í˜œíƒ
- **3ì¼ ë¬´ë£Œ** í˜¸ìŠ¤íŒ… (72ì‹œê°„)
- ë” ì•ˆì •ì ì¸ ì„œë¹„ìŠ¤
- ë°°í¬ íˆìŠ¤í† ë¦¬ ê´€ë¦¬

## ğŸ” íšŒì›ê°€ì… ì•ˆë‚´

ë°°í¬ ì™„ë£Œ í›„ ë‹¤ìŒ ë§í¬ì—ì„œ íšŒì›ê°€ì…í•˜ì‹œë©´:
- **ë¬´ë£Œ 3ì¼ ì—°ì¥** (ì´ 72ì‹œê°„)
- **ë°°í¬ íˆìŠ¤í† ë¦¬** ê´€ë¦¬
- **ì»¤ìŠ¤í…€ ë„ë©”ì¸** ì—°ê²° ê°€ëŠ¥
- **ë” ë§ì€ ìŠ¤í† ë¦¬ì§€** ì œê³µ

ğŸ‘‰ **íšŒì›ê°€ì… ë§í¬:** https://www.miri.dev/dashboard

## ğŸ› ï¸ ì‚¬ìš© ê°€ëŠ¥í•œ ë„êµ¬ë“¤

1. **check_auth_status** - ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
2. **get_deployment_status** - ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸  
3. **deploy_from_current_artifact** - ì›í´ë¦­ í†µí•© ë°°í¬ (ê¶Œì¥)

## ğŸ“ ì§€ì›

ë¬¸ì œê°€ ìˆìœ¼ì‹œë©´:
- ì´ìŠˆ: GitHub ë¦¬í¬ì§€í† ë¦¬
- ì´ë©”ì¼: support@miri.dev
- ë¬¸ì„œ: https://www.miri.dev/docs

---

ğŸ’¡ **íŒ:** ë°°í¬ ì „ì— \`get_deployment_status\`ë¡œ ì„œë¹„ìŠ¤ ìƒíƒœë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!
`;
  }

  async run() {
    const transport = new StdioServerTransport();
    await this.server.connect(transport);
    console.error('ğŸš€ miri.dev MCP Serverê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤');
  }
}

// ì„œë²„ ì‹œì‘
const server = new MiriDevMCPServer();
server.run().catch(console.error); 